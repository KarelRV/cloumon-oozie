<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="/resources/css/flow.css"/>
<link rel="stylesheet" href="/resources/css/demo.css"/>
<link rel="stylesheet" href="/resources/css/workflow/item.css"/>

<script type="text/javascript" src="/resources/js/lib/jquery.js"></script>
<script type="text/javascript" src="/resources/js/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="/resources/js/lib/jquery.jsPlumb-1.3.10-all.js"></script>
<script type="text/javascript" src="/resources/js/workflow/workflow-item.js"></script>
<!-- 
<script type="text/javascript" src="/resources/js/simpleyui-min.js"></script>
<script type="text/javascript" src="/resources/js/yui.jsPlumb-1.3.10-all.js"></script>
<script type="text/javascript" src="/resources/js/mootools.jsPlumb-1.3.10-all.js"></script>
 -->
 
<script>
window.jsPlumbWorkflow = {
	init : function() {
		jsPlumb.importDefaults({
			DragOptions : { cursor: 'pointer', zIndex:2000 },
			PaintStyle : { strokeStyle:'#666' },
			//EndpointStyle : { width:8, height:8, strokeStyle:'#666' },
			//Endpoint : "Rectangle",
			//Anchors : ["TopCenter", "TopCenter"]
		});						

		var connections = [];
		var updateConnections = function(conn, remove) {
			if (!remove) {
				connections.push(conn);
			} else {
				var idx = -1;
				for (var i = 0; i < connections.length; i++) {
					if (connections[i] == conn) {
						idx = i; break;
					}
				}
				if (idx != -1) {
					connections.splice(idx, 1);
				}
			}
			if (connections.length > 0) {
				var s = "<span>current connections</span><br/><br/><table><tr><th>scope</th><th>source</th><th>target</th></tr>";
				for (var j = 0; j < connections.length; j++) {
					s = s + "<tr><td>" + connections[j].scope + "</td>" + "<td>" + connections[j].sourceId + "</td><td>" + connections[j].targetId + "</td></tr>";
				}
				jsPlumbWorkflow.showConnectionInfo(s);
			} else { 
				jsPlumbWorkflow.hideConnectionInfo();
			}
		};				

		jsPlumb.bind("jsPlumbConnection", function(info, originalEvent) {
			//updateConnections(info.connection);
		});
		jsPlumb.bind("jsPlumbConnectionDetached", function(info, originalEvent) {
			//updateConnections(info.connection, true);
		});
	
		var exampleDropOptions = {
			tolerance:'touch',
			hoverClass:'dropHover',
			activeClass:'dragActive'
		};

		var exampleColor = "#00f";
		var exampleEndpoint = {
			endpoint:"Rectangle",
			paintStyle:{ width:15, height:15, fillStyle:exampleColor },
			isSource:true,
	//		reattach:true,
			scope:"blue rectangle",
			connectorStyle : {
				gradient:{stops:[[0, exampleColor], [0.5, "#09098e"], [1, exampleColor]]},
				lineWidth:5,
				strokeStyle:exampleColor,
				dashstyle:"2 2"
			},
			isTarget:true,
			beforeDrop:function(params) { return confirm("Connect " + params.sourceId + " to " + params.targetId + "?"); },				
			dropOptions : exampleDropOptions,
			beforeDetach:function(conn) { 
				return confirm("Detach connection?"); 
			}
			//maxConnections:10,
		};

		var anchors = ["TopCenter"];
		jsPlumb.addEndpoint("window1", { anchor: "TopCenter" }, exampleEndpoint);
		jsPlumb.addEndpoint("window1", { anchor: "BottomCenter" }, exampleEndpoint);
		jsPlumb.addEndpoint('window2', { anchor: anchors}, exampleEndpoint);
		jsPlumb.addEndpoint('window3', { anchor: anchors}, exampleEndpoint);
		jsPlumb.addEndpoint('window4', { anchor: anchors}, exampleEndpoint);
	
		// three ways to do this - an id, a list of ids, or a selector (note the two different types of selectors shown here...anything that is valid jquery will work of course)
		//jsPlumb.draggable("window1");
		//jsPlumb.draggable(["window1", "window2"]);
		//jsPlumb.draggable($("#window1"));
		var divsWithWindowClass = jsPlumb.CurrentLibrary.getSelector(".window");
		jsPlumb.draggable(divsWithWindowClass);
	}
};

 $(document).ready(function() {
	 // chrome fix.
	document.onselectstart = function () { return false; };				

	jsPlumbWorkflow.init();
 });
 </script>
</head>
<body onunload="jsPlumb.unload();">
<div id="demo">
	<div class="window" id="window1">
		one<br/><br/>
		<a href="#" class="cmdLink hide" rel="window1">toggle connections</a><br/>
		<a href="#" class="cmdLink drag" rel="window1">disable dragging</a><br/>
		<a href="#" class="cmdLink detach" rel="window1">detach all</a>
	</div>
	<div class="window" id="window2">
		two<br/><br/>
		<a href="#" class="cmdLink hide" rel="window2">toggle connections</a><br/>
		<a href="#" class="cmdLink drag" rel="window2">disable dragging</a><br/>
		<a href="#" class="cmdLink detach" rel="window2">detach all</a>
	</div>
	<div class="window" id="window3">
		three<br/><br/>
		<a href="#" class="cmdLink hide" rel="window3">toggle connections</a><br/>
		<a href="#" class="cmdLink drag" rel="window3">disable dragging</a><br/>
		<a href="#" class="cmdLink detach" rel="window3">detach all</a>
	</div>
	<div class="window" id="window4">
		four<br/><br/>
		<a href="#" class="cmdLink hide" rel="window4">toggle connections</a><br/>
		<a href="#" class="cmdLink drag" rel="window4">disable dragging</a><br/>
		<a href="#" class="cmdLink detach" rel="window4">detach all</a>
	</div>	
</div>
</body>
</html>